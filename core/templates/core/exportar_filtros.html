{% extends 'core/base.html' %}

{% block title %}Inventory report{% endblock %}

{% block content %}
<div class="row justify-content-center align-items-center" style="min-height: 75vh;">
    <div class="col-md-6 col-lg-5">

        <div class="text-center mb-4">
            <div class="rounded-circle d-inline-flex align-items-center justify-content-center shadow-sm mb-3"
                style="width: 80px; height: 80px; background-color: #f8f9fa; border: 2px solid #012768;">
                <i class="bi bi-file-earmark-spreadsheet" style="font-size: 2.5rem; color: #012768;"></i>
            </div>
            <h4 class="fw-bold" style="color: #012768;">Custom excel report</h4>
            <p class="text-muted">Select category to view subcategories</p>
        </div>

        <div class="card border-0 shadow-sm overflow-hidden">
            <div class="card-header text-white py-3" style="background-color: #012768;">
                <h5 class="mb-0 small fw-bold"><i class="bi bi-funnel me-2"></i>Filter</h5>
            </div>
            <div class="card-body p-4">
                <form action="{% url 'exportar_excel' %}" method="GET">

                    <div class="mb-3">
                        <label class="form-label text-dark small">
                            <i class="bi bi-folder me-1"></i> Category
                        </label>
                        <select name="categoria" id="id_categoria" class="form-select border-2">
                            <option value="todas">-- All --</option>
                            {% for cat in categorias %}
                            <option value="{{ cat.id }}">{{ cat.nombre }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-4">
                        <label class="form-label text-dark small ">
                            <i class="bi bi-tags me-1"></i> Sucategory
                        </label>
                        <select name="subcategoria" id="id_subcategoria" class="form-select  border-2">
                            <option value="todas" data-categoria="todas">-- All --</option>
                            {% for sub in subcategorias %}
                            <option value="{{ sub.id }}" data-categoria="{{ sub.categoria.id }}">
                                {{ sub.nombre }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="d-grid gap-3">
                        <button type="submit" class="btn text-white shadow-sm"
                            style="background-color: #198754;">
                            <i class="bi bi-download me-2"></i>Download
                        </button>
                        <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary">Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const selectCategoria = document.getElementById('id_categoria');
        const selectSubcategoria = document.getElementById('id_subcategoria');

        if (!selectCategoria || !selectSubcategoria) {
            console.error("No se encontraron los selectores en el DOM. Verifica que los IDs coincidan.");
            return;
        }

        const opcionesOriginales = Array.from(selectSubcategoria.options);

        selectCategoria.addEventListener('change', function () {
            const categoriaId = this.value;

            selectSubcategoria.innerHTML = '';

            opcionesOriginales.forEach(opcion => {
                const dataCat = opcion.getAttribute('data-categoria');

                if (opcion.value === 'todas' || categoriaId === 'todas' || dataCat === categoriaId) {
                    selectSubcategoria.appendChild(opcion.cloneNode(true));
                }
            });

            selectSubcategoria.selectedIndex = 0;
        });
    });
</script>
{% endblock %}